{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport * as SecureStore from 'expo-secure-store';\nimport api from \"../utils/api\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext({\n  user: null,\n  isLoading: true,\n  login: function () {\n    var _login = _asyncToGenerator(function* () {});\n    function login() {\n      return _login.apply(this, arguments);\n    }\n    return login;\n  }(),\n  logout: function () {\n    var _logout = _asyncToGenerator(function* () {});\n    function logout() {\n      return _logout.apply(this, arguments);\n    }\n    return logout;\n  }()\n});\nexport var useAuth = function useAuth() {\n  return useContext(AuthContext);\n};\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    isLoading = _useState4[0],\n    setIsLoading = _useState4[1];\n  useEffect(function () {\n    loadUserFromStorage();\n  }, []);\n  var loadUserFromStorage = function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      try {\n        var token = yield SecureStore.getItemAsync('token');\n        var userString = yield SecureStore.getItemAsync('user');\n        if (token && userString) {\n          var userData = JSON.parse(userString);\n          setUser(userData);\n          api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        }\n      } catch (error) {\n        console.error('Error loading user data:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    });\n    return function loadUserFromStorage() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var login = function () {\n    var _ref3 = _asyncToGenerator(function* (email, password) {\n      try {\n        setIsLoading(true);\n        var response = yield api.post('/auth/login', {\n          email: email,\n          password: password\n        });\n        var _response$data = response.data,\n          token = _response$data.token,\n          _user = _response$data.user;\n        yield SecureStore.setItemAsync('token', token);\n        yield SecureStore.setItemAsync('user', JSON.stringify(_user));\n        api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        setUser(_user);\n      } catch (error) {\n        console.error('Login error:', error);\n        throw error;\n      } finally {\n        setIsLoading(false);\n      }\n    });\n    return function login(_x, _x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var logout = function () {\n    var _ref4 = _asyncToGenerator(function* () {\n      try {\n        setIsLoading(true);\n        yield SecureStore.deleteItemAsync('token');\n        yield SecureStore.deleteItemAsync('user');\n        delete api.defaults.headers.common['Authorization'];\n        setUser(null);\n      } catch (error) {\n        console.error('Logout error:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    });\n    return function logout() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  return _jsx(AuthContext.Provider, {\n    value: {\n      user: user,\n      isLoading: isLoading,\n      login: login,\n      logout: logout\n    },\n    children: children\n  });\n};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","SecureStore","api","jsx","_jsx","AuthContext","user","isLoading","login","_login","_asyncToGenerator","apply","arguments","logout","_logout","useAuth","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","setUser","_useState3","_useState4","setIsLoading","loadUserFromStorage","_ref2","token","getItemAsync","userString","userData","JSON","parse","defaults","headers","common","error","console","_ref3","email","password","response","post","_response$data","data","setItemAsync","stringify","_x","_x2","_ref4","deleteItemAsync","Provider","value"],"sources":["C:/Users/GIO/project/mobile-app/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport * as SecureStore from 'expo-secure-store';\r\nimport api from '../utils/api';\r\n\r\ninterface User {\r\n  _id: string;\r\n  firstName: string;\r\n  lastName: string;\r\n  email: string;\r\n  role: string;\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  isLoading: boolean;\r\n  login: (email: string, password: string) => Promise<void>;\r\n  logout: () => Promise<void>;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType>({\r\n  user: null,\r\n  isLoading: true,\r\n  login: async () => {},\r\n  logout: async () => {},\r\n});\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // Check if user is logged in on app start\r\n    loadUserFromStorage();\r\n  }, []);\r\n\r\n  const loadUserFromStorage = async () => {\r\n    try {\r\n      const token = await SecureStore.getItemAsync('token');\r\n      const userString = await SecureStore.getItemAsync('user');\r\n      \r\n      if (token && userString) {\r\n        const userData = JSON.parse(userString);\r\n        setUser(userData);\r\n        api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading user data:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (email: string, password: string) => {\r\n    try {\r\n      setIsLoading(true);\r\n      const response = await api.post('/auth/login', { email, password });\r\n      const { token, user } = response.data;\r\n      \r\n      await SecureStore.setItemAsync('token', token);\r\n      await SecureStore.setItemAsync('user', JSON.stringify(user));\r\n      \r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      setUser(user);\r\n    } catch (error) {\r\n      console.error('Login error:', error);\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      await SecureStore.deleteItemAsync('token');\r\n      await SecureStore.deleteItemAsync('user');\r\n      delete api.defaults.headers.common['Authorization'];\r\n      setUser(null);\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, isLoading, login, logout }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}