{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport * as SecureStore from 'expo-secure-store';\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport api from \"../utils/api\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext({\n  user: null,\n  isLoading: true,\n  login: function () {\n    var _login = _asyncToGenerator(function* () {});\n    function login() {\n      return _login.apply(this, arguments);\n    }\n    return login;\n  }(),\n  logout: function () {\n    var _logout = _asyncToGenerator(function* () {});\n    function logout() {\n      return _logout.apply(this, arguments);\n    }\n    return logout;\n  }()\n});\nexport var useAuth = function useAuth() {\n  return useContext(AuthContext);\n};\nvar Storage = {\n  setItem: function () {\n    var _setItem = _asyncToGenerator(function* (key, value) {\n      if (Platform.OS === 'web') {\n        localStorage.setItem(key, value);\n        return Promise.resolve();\n      } else {\n        return SecureStore.setItemAsync(key, value);\n      }\n    });\n    function setItem(_x, _x2) {\n      return _setItem.apply(this, arguments);\n    }\n    return setItem;\n  }(),\n  getItem: function () {\n    var _getItem = _asyncToGenerator(function* (key) {\n      if (Platform.OS === 'web') {\n        return Promise.resolve(localStorage.getItem(key));\n      } else {\n        return SecureStore.getItemAsync(key);\n      }\n    });\n    function getItem(_x3) {\n      return _getItem.apply(this, arguments);\n    }\n    return getItem;\n  }(),\n  removeItem: function () {\n    var _removeItem = _asyncToGenerator(function* (key) {\n      if (Platform.OS === 'web') {\n        localStorage.removeItem(key);\n        return Promise.resolve();\n      } else {\n        return SecureStore.deleteItemAsync(key);\n      }\n    });\n    function removeItem(_x4) {\n      return _removeItem.apply(this, arguments);\n    }\n    return removeItem;\n  }()\n};\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    isLoading = _useState4[0],\n    setIsLoading = _useState4[1];\n  useEffect(function () {\n    loadUserFromStorage();\n  }, []);\n  var loadUserFromStorage = function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      try {\n        var token = yield Storage.getItem('token');\n        var userString = yield Storage.getItem('user');\n        if (token && userString) {\n          var userData = JSON.parse(userString);\n          setUser(userData);\n          api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        }\n      } catch (error) {\n        console.error('Error loading user data:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    });\n    return function loadUserFromStorage() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var login = function () {\n    var _ref3 = _asyncToGenerator(function* (email, password) {\n      try {\n        setIsLoading(true);\n        var response = yield api.post('/auth/login', {\n          email: email,\n          password: password\n        });\n        var _response$data = response.data,\n          token = _response$data.token,\n          _user = _response$data.user;\n        yield Storage.setItem('token', token);\n        yield Storage.setItem('user', JSON.stringify(_user));\n        api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        setUser(_user);\n      } catch (error) {\n        console.error('Login error:', error);\n        throw error;\n      } finally {\n        setIsLoading(false);\n      }\n    });\n    return function login(_x5, _x6) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var logout = function () {\n    var _ref4 = _asyncToGenerator(function* () {\n      try {\n        setIsLoading(true);\n        yield Storage.removeItem('token');\n        yield Storage.removeItem('user');\n        delete api.defaults.headers.common['Authorization'];\n        setUser(null);\n      } catch (error) {\n        console.error('Logout error:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    });\n    return function logout() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  return _jsx(AuthContext.Provider, {\n    value: {\n      user: user,\n      isLoading: isLoading,\n      login: login,\n      logout: logout\n    },\n    children: children\n  });\n};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","SecureStore","Platform","api","jsx","_jsx","AuthContext","user","isLoading","login","_login","_asyncToGenerator","apply","arguments","logout","_logout","useAuth","Storage","setItem","_setItem","key","value","OS","localStorage","Promise","resolve","setItemAsync","_x","_x2","getItem","_getItem","getItemAsync","_x3","removeItem","_removeItem","deleteItemAsync","_x4","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","setUser","_useState3","_useState4","setIsLoading","loadUserFromStorage","_ref2","token","userString","userData","JSON","parse","defaults","headers","common","error","console","_ref3","email","password","response","post","_response$data","data","stringify","_x5","_x6","_ref4","Provider"],"sources":["C:/Users/GIO/project/mobile-app/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport * as SecureStore from 'expo-secure-store';\r\nimport { Platform } from 'react-native';\r\nimport api from '../utils/api';\r\n\r\ninterface User {\r\n  _id: string;\r\n  firstName: string;\r\n  lastName: string;\r\n  email: string;\r\n  role: string;\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  isLoading: boolean;\r\n  login: (email: string, password: string) => Promise<void>;\r\n  logout: () => Promise<void>;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType>({\r\n  user: null,\r\n  isLoading: true,\r\n  login: async () => {},\r\n  logout: async () => {},\r\n});\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\n// Helper for storage that works in both web and native environments\r\nconst Storage = {\r\n  async setItem(key: string, value: string): Promise<void> {\r\n    if (Platform.OS === 'web') {\r\n      localStorage.setItem(key, value);\r\n      return Promise.resolve();\r\n    } else {\r\n      return SecureStore.setItemAsync(key, value);\r\n    }\r\n  },\r\n  \r\n  async getItem(key: string): Promise<string | null> {\r\n    if (Platform.OS === 'web') {\r\n      return Promise.resolve(localStorage.getItem(key));\r\n    } else {\r\n      return SecureStore.getItemAsync(key);\r\n    }\r\n  },\r\n  \r\n  async removeItem(key: string): Promise<void> {\r\n    if (Platform.OS === 'web') {\r\n      localStorage.removeItem(key);\r\n      return Promise.resolve();\r\n    } else {\r\n      return SecureStore.deleteItemAsync(key);\r\n    }\r\n  }\r\n};\r\n\r\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // Check if user is logged in on app start\r\n    loadUserFromStorage();\r\n  }, []);\r\n\r\n  const loadUserFromStorage = async () => {\r\n    try {\r\n      const token = await Storage.getItem('token');\r\n      const userString = await Storage.getItem('user');\r\n      \r\n      if (token && userString) {\r\n        const userData = JSON.parse(userString);\r\n        setUser(userData);\r\n        api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading user data:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (email: string, password: string) => {\r\n    try {\r\n      setIsLoading(true);\r\n      const response = await api.post('/auth/login', { email, password });\r\n      const { token, user } = response.data;\r\n      \r\n      await Storage.setItem('token', token);\r\n      await Storage.setItem('user', JSON.stringify(user));\r\n      \r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      setUser(user);\r\n    } catch (error) {\r\n      console.error('Login error:', error);\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      await Storage.removeItem('token');\r\n      await Storage.removeItem('user');\r\n      delete api.defaults.headers.common['Authorization'];\r\n      setUser(null);\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, isLoading, login, logout }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}